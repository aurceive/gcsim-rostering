# Правила таблицы wfpsim_discord_archiver

Эти правила применяются к локальной таблице (XLSX) и должны быть воспроизведены в Google Sheets.

## Назначение

Таблица хранит результаты архивации ссылок `wfpsim.com/sh/<uuid>` из Discord и данные, полученные из `https://wfpsim.com/api/share/<uuid>`.

## Где хранится

- Локально (всегда): `output/wfpsim_discord_archiver/archive.xlsx`
- Google Sheets (условно): только если `run.dryRun: false`

## Уникальность

- Ключ `Key` уникален.
- При добавлении новых данных строка с уже существующим `Key` **не добавляется**.

## Сортировка

Всегда после добавления/обновления таблица должна быть отсортирована:

1. `TeamCharacters` (техническое поле, без созвездий) по возрастанию (ASC), пустые значения — внизу
2. Внутри каждого набора персонажей разделить строки на блоки по `TeamConstellations`.
3. Эти блоки отсортировать по максимальному `TeamDpsMean` в блоке (DESC).
4. Внутри каждого блока строки отсортировать по `TeamDpsMean` (DESC).

## Порядок столбцов

Первые столбцы таблицы должны быть:

1. `TeamCharactersUI`
2. `TeamWeapons`
3. `TeamDpsMean`
4. `ShareURL`
5. `ConfigFile`
6. `DiscordMessageCreatedAt`
7. `DiscordAuthor`

Техническое поле `TeamCharacters` должно находиться где-то после этих "интересных" колонок.
Техническое поле `TeamConstellations` должно находиться после этих "интересных" колонок.
Все остальные столбцы должны идти после них (порядок “хвоста” может быть любым, но должен быть стабильным).

## Первый столбец (визуальное правило, без форматирования)

- Никаких merge/выравниваний/оформления не применяется (кроме фиксированной высоты строк).
- В первом столбце (`TeamCharactersUI`) повторяющиеся соседние значения **не объединяются**.
 Вместо этого: значение пишется только в первой строке непрерывной группы после сортировки, а в остальных строках группы ячейка должна быть пустой.

## Созвездия

- `TeamConstellations` содержит уровни созвездий персонажей, выровненные по порядку персонажей в `TeamCharacters`.
- Формат: `C0,C2,C6,C0` (разделитель запятая).

## Первый столбец (UI)

- `TeamCharactersUI` содержит персонажей сразу с созвездиями в одном поле, выровненно по `TeamCharacters`/`TeamConstellations`.
- Пример: `columbina C0,ineffa C2,sara C6,sucrose C0`.

## Примечания по Google Sheets

- Скрипт после вставки пересортировывает таблицу и приводит `TeamCharactersUI` к правилу “первая строка заполнена, остальные пустые”.
