# Структура репозитория и правила размещения файлов

Этот документ фиксирует **правила организации файлов/папок** в репозитории. Он описывает *куда класть новые файлы* и *что не должно появляться в git*.

## Дерево (с правилами на ветках)

```text
.
├─ README.md
│  └─ Правило: корневой пайплайн/инструкции запуска (Windows/PowerShell), ссылки на подробные документы.
│
├─ apps/
│  └─ <app_name>/
│     └─ Правило: каждая папка — отдельное приложение. Внутреннюю структуру см. «Шаблон приложения» ниже.
│
├─ engines/
│  ├─ README.md
│  │  └─ Правило: правила сабмодулей, сборки CLI и расположения бинарей.
│  ├─ <engine>/ (submodule)
│  │  └─ Правило: сабмодуль движка; исходники движка не менять артефактами сборки.
│  └─ bins/
│     └─ <engine>/
│        └─ Правило: сюда складываются собранные exe движков; сабмодули держать «чистыми».
│
├─ scripts/
│  ├─ engines/
│  │  └─ Правило: скрипты инициализации/обновления сабмодулей и сборки CLI движков.
│  └─ <area_or_app>/
│     └─ Правило: скрипты bootstrap/утилиты для области/приложения.
│
├─ data/
│  └─ Правило: версионируемые справочники/данные проекта (то, что должно быть в git).
│
├─ input/
│  ├─ <app>/
│  │  ├─ examples/
│  │  │  └─ Правило: эталонные/демо-входы для приложения. Коммитятся.
│  │  └─ <local-files>
│  │     └─ Правило: локальные конфиги/входы/секреты/снапшоты для запуска. Обычно НЕ коммитятся (см. .gitignore).
│  └─ Правило: входы для локального запуска. Репозиторий не фиксирует названия/форматы этих файлов.
│
├─ output/
│  ├─ <app>/
│  │  └─ Правило: результаты каждого приложения обязаны складываться в свой подкаталог.
│  └─ Правило: генерируемые результаты. Должно быть игнорируемым (см. .gitignore).
│
└─ work/
   └─ Правило: временные/отладочные файлы и промежуточные артефакты. Должно быть игнорируемым.
```

## Шаблон приложения (рекомендуемая внутренняя структура)

Этот раздел описывает **типовую** структуру папки `apps/<app_name>/`. Он не предполагает наличие конкретных приложений.

```text
apps/<app_name>/
├─ go.mod
│  └─ Правило: приложение — отдельный Go module.
├─ README.md
│  └─ Правило: как собрать/запустить приложение и где искать результат.
├─ cmd/
│  └─ <app_name>/
│     └─ Правило: entrypoint (main) — только wiring/CLI/инициализация.
└─ internal/
  ├─ app/
  │  └─ Правило: orchestration/use-cases (связывает слои).
  ├─ config/
  │  └─ Правило: чтение/валидация конфигов (yaml/txt), без предметных правил.
  ├─ domain/
  │  └─ Правило: предметная модель/правила; не импортировать IO/Excel/OS exec.
  ├─ engine/
  │  └─ Правило: адаптер запуска движка; формирование input/парсинг output.
  ├─ output/
  │  └─ Правило: генерация результатов (xlsx/файлы). Домен не зависит от этого.
  ├─ sim/
  │  └─ Правило: слой выполнения/склейки прогонов (если нужен), отдельно от домена.
  ├─ tests/
  │  └─ Правило: тесты приложения (unit/интеграционные). Не класть сюда артефакты.
  └─ <feature>/
    └─ Правило: приложение-специфичные пакеты (фичи/справочники), если они не «общие».
```

## Общие правила (коротко)

- **Новые приложения** добавлять в `apps/<app_name>/` как отдельный Go module (`go.mod`), с `cmd/<app_name>/` и `internal/`.
- **Структура внутри `internal/`** должна отражать зависимости по слоям: `domain` не зависит от `engine/output/config`; `app` связывает слои.
- **Новый общий код** между приложениями не вводить «на всякий случай»; если появится — обсудить отдельную папку/модуль (например, `pkg/` или `libs/`) и закрепить решением (ADR).
- **Сабмодули движков** живут только в `engines/<engine>/`; собранные бинарники — только в `engines/bins/<engine>/`.
- **Входы/выходы прогона**:
  - `input/` — локальные входы/конфиги/секреты (коммитим только `examples/`).
  - `output/<app>/` — генерируемые результаты по приложениям (в git не попадает).
  - `work/` — временное/отладочное (в git не попадает).
- **Скрипты** — только автоматизация (bootstrap/build/update), без хранения артефактов.
- **Рекомендуемый пайплайн для каждого приложения**:
  1. Сборка движков (если нужно): `scripts/engines/bootstrap.ps1`
  2. Сборка приложения: `scripts/<app>/bootstrap.ps1`
      - Создание конфига из `examples/`, если нужно.
      - Скачивание зависимостей.
      - Сборка CLI в `apps/<app>/`.
  3. Заполнение/проверка входных данных в `input/<app>/`.
  4. Запуск `apps/<app>/<app>.exe [args]`.

## Ссылки

- Основной пайплайн: см. `README.md`
- Движки и сборка CLI: `engines/README.md`
